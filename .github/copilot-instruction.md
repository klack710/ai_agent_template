# Copilot Agent Instructions (JP)

## 共通前提
- 生成する **コミットメッセージ・PR コメント・コード内コメントはすべて日本語**。
- OS は **Windows 11 / PowerShell**。パス区切りは `\` を使用。

## 変更ルール
1. **差分編集のみ**。ファイル全削除＋再生成は禁止。  
2. **Black** (line-length 88, 4 スペース) と **Ruff** を必ず通す。  
   - 変更後に実行  
     ```pwsh
     pre-commit run --all-files
     pytest -q
     ```  
     失敗時は **修正提案のみ** を提示し、自動再修復しない。  
3. 改行削除による連結や、1 行に複数の `def` / `class` / `if` を置くことを厳禁。  
4. **500 行超のファイル** は `#selection` で範囲を絞るかファイル分割を提案する。  
5. 1 コミットで **300 行以上変更** または **5 ファイル以上編集** する場合は、事前にユーザーへ確認。

## コミットメッセージ
- **Conventional Commits** を日本語で記述。例:  
  `feat: ログイン機能を追加`

## コマンド実行ガイド
- コマンド例は *必ず* PowerShell 形式で記述:  
  `pytest -q`, `pre-commit run --all-files` など。  
- 実行後 30 秒たっても PowerShell プロンプト (`PS >`) が返らない場合はユーザーに確認を促す。

## プロンプト管理
- 大きな課題は **タスクを分割** し、各ステップで必要最小限の `#file` / `#selection` を送る。  

## 緊急停止
- テストまたは構文エラーが **連続で 2 回** 発生したら編集を中断し、  
  差分・エラーログ・考えられる原因を報告する。
